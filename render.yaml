# ─── Render.com Blueprint (Infrastructure-as-Code) ───────────────
# Deploy:  https://render.com/deploy → connect your Git repo
#
# This creates a single web service that runs both the API server
# and processes jobs in background threads (no Redis/Celery needed).
#
# One-click: https://render.com/deploy?repo=https://github.com/Xornyv3/clipforge

services:
  - type: web
    name: clipforge
    runtime: python
    plan: free
    repo: https://github.com/Xornyv3/clipforge
    buildCommand: |
      pip install -r requirements-web.txt
      python -c "from faster_whisper import WhisperModel; WhisperModel('tiny', device='cpu', compute_type='int8')" || true
    startCommand: uvicorn web.app:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: USE_CELERY
        value: "false"
      - key: CLIPFORGE_UPLOAD_DIR
        value: /tmp/clipforge/uploads
      - key: CLIPFORGE_OUTPUT_DIR
        value: /tmp/clipforge/outputs
      - key: CLIPFORGE_WORK_DIR
        value: /tmp/clipforge/work
      - key: CLIPFORGE_PUBLIC_URL
        sync: false
      - key: CLIPFORGE_MAX_UPLOAD_MB
        value: "200"
      - key: PYTHON_VERSION
        value: "3.10.0"
    healthCheckPath: /api/health
